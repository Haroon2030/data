{% extends "base.html" %}
{% load static %}

{% block title %}Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù{% endblock %}

{% block content %}
<div class="table-container">
    <h3 class="text-center mb-4">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
    
    <!-- Ø´Ø±ÙŠØ· Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
    <div class="table-toolbar">
        <div class="btn-group">
            <button type="button" class="btn btn-primary" onclick="exportExcel()" title="ØªØµØ¯ÙŠØ± Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ù…Ù„Ù Excel">
                <img src="{% static 'icons/excel.png' %}" style="width: 18px; height: 18px; vertical-align: text-bottom; margin-left: 5px;">
                ØªØµØ¯ÙŠØ± Excel
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="exportCSV()" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØªÙ†Ø³ÙŠÙ‚ CSV">
                ğŸ“Š ØªØµØ¯ÙŠØ± CSV
            </button>
            <button type="button" class="btn btn-secondary" onclick="printTable()">
                ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
            </button>
            <!-- ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø²Ø± Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯ -->
        </div>
        
        <div class="search-container">
            <form method="GET" action="{% url 'item_list' %}">
                <input type="text" class="form-control" id="quickSearch" name="search" placeholder="ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹..." 
                       style="width: 250px; border-radius: 25px;" value="{{ search_query }}">
            </form>
        </div>
        
        <div class="info-badge">
            <span class="badge bg-info" id="totalCount">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: {{ page_obj.paginator.count }} Ø¹Ù†Ø§ØµØ±</span>
        </div>
    </div>
    
    <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover">
            <thead>
                <tr>
                    <th scope="col" class="sortable" data-sort="number">#
                        <span class="sort-icon"></span>
                    </th>
                    <th scope="col" class="sortable" data-sort="name">Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù
                        <span class="sort-icon"></span>
                    </th>
                    <th scope="col" class="sortable" data-sort="barcode">Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
                        <span class="sort-icon"></span>
                    </th>
                    <th scope="col" class="sortable" data-sort="package">Ø§Ù„Ø¹Ø¨ÙˆØ©
                        <span class="sort-icon"></span>
                    </th>
                    <th scope="col" class="sortable" data-sort="company">Ø§Ù„Ø´Ø±ÙƒØ©
                        <span class="sort-icon"></span>
                    </th>
                    <th scope="col" class="sortable" data-sort="submitter">Ø§Ù„Ù…Ø¯Ø®Ù„ Ø§Ù„Ù…Ø±Ø³Ù„
                        <span class="sort-icon"></span>
                    </th>
                    <th scope="col" class="sortable" data-sort="unit">ÙˆØ­Ø¯Ø© Ø§Ù„ØµÙ†Ù
                        <span class="sort-icon"></span>
                    </th>
                    <th scope="col">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="itemsTableBody">
                {% for item in page_obj %}
                <tr data-id="{{ item.id }}">
                    <td class="row-number">{{ forloop.counter }}</td>
                    <td data-sort-value="{{ item.name }}">{{ item.name }}</td>
                    <td data-sort-value="{{ item.barcode }}">{{ item.barcode }}</td>
                    <td data-sort-value="{{ item.package }}">{{ item.package }}</td>
                    <td data-sort-value="{{ item.company }}">{{ item.company }}</td>
                    <td data-sort-value="{{ item.submitter }}">{{ item.submitter }}</td>
                    <td data-sort-value="{{ item.unit }}">{{ item.unit }}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <a href="{% url 'item_detail' item.id %}" class="btn btn-info">Ø¹Ø±Ø¶</a>
                            <!-- ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù -->
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª -->
{% if page_obj.has_other_pages %}
<div class="pagination-container">
    <nav aria-label="ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª">
        <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" tabindex="-1">Ø§Ù„Ø³Ø§Ø¨Ù‚</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1">Ø§Ù„Ø³Ø§Ø¨Ù‚</a>
            </li>
            {% endif %}
            
            {% for i in page_obj.paginator.page_range %}
                {% if page_obj.number == i %}
                <li class="page-item active">
                    <a class="page-link" href="#">{{ i }}</a>
                </li>
                {% else %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ i }}{% if search_query %}&search={{ search_query }}{% endif %}">{{ i }}</a>
                </li>
                {% endif %}
            {% endfor %}
            
            {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">Ø§Ù„ØªØ§Ù„ÙŠ</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" href="#">Ø§Ù„ØªØ§Ù„ÙŠ</a>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    // Ø¯Ø§Ù„Ø© ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ù…Ù„Ù Excel
    function exportExcel() {
        const table = document.querySelector('table');
        const wb = XLSX.utils.table_to_book(table, {sheet: "Ø§Ù„Ø£ØµÙ†Ø§Ù"});
        XLSX.writeFile(wb, "Ø§Ù„Ø£ØµÙ†Ø§Ù_" + new Date().toISOString().slice(0,10) + ".xlsx");
    }
    
    // Ø¯Ø§Ù„Ø© ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØªÙ†Ø³ÙŠÙ‚ CSV
    function exportCSV() {
        const table = document.querySelector('table');
        const wb = XLSX.utils.table_to_book(table);
        const csv = XLSX.utils.sheet_to_csv(wb.Sheets[wb.SheetNames[0]]);
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        
        link.setAttribute("href", url);
        link.setAttribute("download", "Ø§Ù„Ø£ØµÙ†Ø§Ù_" + new Date().toISOString().slice(0,10) + ".csv");
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
    
    // Ø¯Ø§Ù„Ø© Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„
    function printTable() {
        const tableContainer = document.querySelector('.table-container').innerHTML;
        const printWindow = window.open('', '_blank');
        
        printWindow.document.write(`
            <!DOCTYPE html>
            <html lang="ar" dir="rtl">
            <head>
                <meta charset="UTF-8">
                <title>Ø·Ø¨Ø§Ø¹Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù</title>
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
                <style>
                    @media print {
                        .btn-group, .search-container, .pagination-container {
                            display: none !important;
                        }
                    }
                    body {
                        font-family: 'Cairo', sans-serif;
                        padding: 20px;
                    }
                    h3 {
                        text-align: center;
                        margin-bottom: 20px;
                    }
                    table {
                        width: 100%;
                        border-collapse: collapse;
                    }
                    th, td {
                        padding: 8px;
                        border: 1px solid #ddd;
                    }
                    th {
                        background-color: #f2f2f2;
                    }
                </style>
            </head>
            <body>
                ${tableContainer}
            </body>
            </html>
        `);
        
        printWindow.document.close();
        printWindow.onload = function() {
            printWindow.print();
        };
    }
    
    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© ÙˆØ¸ÙŠÙØ© Ø­Ø°Ù Ø§Ù„ØµÙ†Ù
</script>
{% endblock %}
